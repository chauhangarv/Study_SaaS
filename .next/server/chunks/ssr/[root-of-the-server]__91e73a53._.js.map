{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/chauh/OneDrive/Desktop/Coding/saas/lib/vapi.sdk.ts"],"sourcesContent":["import Vapi from \"@vapi-ai/web\";\r\n\r\nexport const vapi = new Vapi(process.env.NEXT_PUBLIC_VAPI_WEB_TOKEN!);"],"names":[],"mappings":";;;AAAA;;AAEO,MAAM,OAAO,IAAI,mJAAA,CAAA,UAAI","debugId":null}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/chauh/OneDrive/Desktop/Coding/saas/components/CompanionComponent.tsx"],"sourcesContent":["'use client';\r\n\r\nimport {useEffect, useRef, useState} from 'react'\r\nimport {cn, configureAssistant, getSubjectColor} from \"@/lib/utils\";\r\nimport {vapi} from \"@/lib/vapi.sdk\";\r\nimport Image from \"next/image\";\r\nimport Lottie, {LottieRefCurrentProps} from \"lottie-react\";\r\nimport soundwaves from '@/constants/soundwaves.json'\r\n\r\nenum CallStatus {\r\n    INACTIVE = 'INACTIVE',\r\n    CONNECTING = 'CONNECTING',\r\n    ACTIVE = 'ACTIVE',\r\n    FINISHED = 'FINISHED',\r\n}\r\n\r\nconst CompanionComponent = ({ companionId, subject, topic, name, userName, userImage, style, voice }: CompanionComponentProps) => {\r\n    const [callStatus, setCallStatus] = useState<CallStatus>(CallStatus.INACTIVE);\r\n    const [isSpeaking, setIsSpeaking] = useState(false);\r\n    const [isMuted, setIsMuted] = useState(false);\r\n    const [messages, setMessages] = useState<SavedMessage[]>([]);\r\n\r\n\r\n    const lottieRef = useRef<LottieRefCurrentProps>(null);\r\n\r\n    useEffect(() => {\r\n        if(lottieRef) {\r\n            if(isSpeaking) {\r\n                lottieRef.current?.play()\r\n            } else {\r\n                lottieRef.current?.stop()\r\n            }\r\n        }\r\n    }, [isSpeaking, lottieRef])\r\n\r\n    useEffect(() => {\r\n        const onCallStart = () => setCallStatus(CallStatus.ACTIVE);\r\n\r\n        const onCallEnd =() => setCallStatus(CallStatus.FINISHED);\r\n\r\n        const onMessage = (message: Message) => {\r\n            if(message.type === 'transcript' && message.transcriptType === 'final') {\r\n                const newMessage= { role: message.role, content: message.transcript}\r\n                setMessages((prev) => [newMessage, ...prev])\r\n            }\r\n        }\r\n\r\n        const onSpeechStart = () => setIsSpeaking(true);\r\n        const onSpeechEnd = () => setIsSpeaking(false);\r\n\r\n        const onError = (error: Error) => console.log('Error', error);\r\n\r\n        vapi.on('call-start', onCallStart);\r\n        vapi.on('call-end', onCallEnd);\r\n        vapi.on('message', onMessage);\r\n        vapi.on('error', onError);\r\n        vapi.on('speech-start', onSpeechStart);\r\n        vapi.on('speech-end', onSpeechEnd);\r\n\r\n        return () => {\r\n            vapi.off('call-start', onCallStart);\r\n            vapi.off('call-end', onCallEnd);\r\n            vapi.off('message', onMessage);\r\n            vapi.off('error', onError);\r\n            vapi.off('speech-start', onSpeechStart);\r\n            vapi.off('speech-end', onSpeechEnd);\r\n        }\r\n    }, []);\r\n\r\n    const toggleMicrophone = () => {\r\n        const isMuted = vapi.isMuted();\r\n        vapi.setMuted(!isMuted);\r\n        setIsMuted(!isMuted)\r\n    }\r\n\r\n    const handleCall = async () => {\r\n        setCallStatus(CallStatus.CONNECTING)\r\n\r\n        const assistantOverrides = {\r\n            variableValues: { subject, topic, style },\r\n            clientMessages: [\"transcript\"],\r\n            serverMessages: [],\r\n        }\r\n\r\n        // @ts-expect-error\r\n        vapi.start(configureAssistant(voice, style), assistantOverrides)\r\n    }\r\n\r\n    const handleDisconnect = () => {\r\n        setCallStatus(CallStatus.FINISHED)\r\n        vapi.stop()\r\n    }\r\n\r\n    return (\r\n        <section className=\"flex flex-col h-[70vh]\">\r\n            <section className=\"flex gap-8 max-sm:flex-col\">\r\n                <div className=\"companion-section\">\r\n                    <div className=\"companion-avatar\" style={{ backgroundColor: getSubjectColor(subject)}}>\r\n                        <div\r\n                            className={\r\n                            cn(\r\n                                'absolute transition-opacity duration-1000', callStatus === CallStatus.FINISHED || callStatus === CallStatus.INACTIVE ? 'opacity-1001' : 'opacity-0', callStatus === CallStatus.CONNECTING && 'opacity-100 animate-pulse'\r\n                            )\r\n                        }>\r\n                            <Image src={`/icons/${subject}.svg`} alt={subject} width={150} height={150} className=\"max-sm:w-fit\" />\r\n                        </div>\r\n\r\n                        <div className={cn('absolute transition-opacity duration-1000', callStatus === CallStatus.ACTIVE ? 'opacity-100': 'opacity-0')}>\r\n                            <Lottie\r\n                                lottieRef={lottieRef}\r\n                                animationData={soundwaves}\r\n                                autoplay={false}\r\n                                className=\"companion-lottie\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"font-bold text-2xl\">{name}</p>\r\n                </div>\r\n\r\n                <div className=\"user-section\">\r\n                    <div className=\"user-avatar\">\r\n                        <Image src={userImage} alt={userName} width={130} height={130} className=\"rounded-lg\" />\r\n                        <p className=\"font-bold text-2xl\">\r\n                            {userName}\r\n                        </p>\r\n                    </div>\r\n                    <button className=\"btn-mic\" onClick={toggleMicrophone} disabled={callStatus !== CallStatus.ACTIVE}>\r\n                        <Image src={isMuted ? '/icons/mic-off.svg' : '/icons/mic-on.svg'} alt=\"mic\" width={36} height={36} />\r\n                        <p className=\"max-sm:hidden\">\r\n                            {isMuted ? 'Turn on microphone' : 'Turn off microphone'}\r\n                        </p>\r\n                    </button>\r\n                    <button className={cn('rounded-lg py-2 cursor-pointer transition-colors w-full text-white', callStatus ===CallStatus.ACTIVE ? 'bg-red-700' : 'bg-primary', callStatus === CallStatus.CONNECTING && 'animate-pulse')} onClick={callStatus === CallStatus.ACTIVE ? handleDisconnect : handleCall}>\r\n                        {callStatus === CallStatus.ACTIVE\r\n                        ? \"End Session\"\r\n                        : callStatus === CallStatus.CONNECTING\r\n                            ? 'Connecting'\r\n                        : 'Start Session'\r\n                        }\r\n                    </button>\r\n                </div>\r\n            </section>\r\n\r\n            <section className=\"transcript\">\r\n                <div className=\"transcript-message no-scrollbar\">\r\n                    {messages.map((message, index) => {\r\n                        if(message.role === 'assistant') {\r\n                            return (\r\n                                <p key={index} className=\"max-sm:text-sm\">\r\n                                    {\r\n                                        name\r\n                                            .split(' ')[0]\r\n                                            .replace('/[.,]/g, ','')\r\n                                    }: {message.content}\r\n                                </p>\r\n                            )\r\n                        } else {\r\n                           return <p key={index} className=\"text-primary max-sm:text-sm\">\r\n                                {userName}: {message.content}\r\n                            </p>\r\n                        }\r\n                    })}\r\n                </div>\r\n\r\n                <div className=\"transcript-fade\" />\r\n            </section>\r\n        </section>\r\n    )\r\n}\r\n\r\nexport default CompanionComponent"],"names":[],"mappings":"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","debugId":null}}]
}